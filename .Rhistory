<<<<<<< HEAD
=======
select(title, weeks_on_list, buy_links)
>>>>>>> bd5975d09bd904042fef0491467cbb612a5ab9a0
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price1 <-as.numeric(sub('\\$','',as.character(price1)))
print(price1)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
} else if (length(price2)==0) {
price3=NA
print(price3)
}
})
if (length(price1)==1) {
price1 <-as.numeric(sub('\\$','',as.character(price1)))
print(price1)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
} else if (length(price2)==0) {
price3=NA
print(price3)
}
if (length(price1)==1) {
price1 <-as.numeric(sub('\\$','',as.character(price1)))
print(price1)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
})
arow <-combined.df[2,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
if (length(price2)==0) {
price2=NA
}
print(price2)
x=5
arow <-combined.df[2,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
})
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
return(price2)
})
all.price <-do.call(rbind,PriceInfo) #it shows all price for only 312, but there's 315.
PriceInfo
arow <-combined.df[39,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
arow <-combined.df[40,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
arow <-combined.df[40,]
every <-as.data.frame(arow["buy_links"])
for(i in 1:nrow(combined.df)) {
every <-as.data.frame(i["buy_links"])
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
return(price2)
}
lapply(combined.df,1:nrow(combined.df),PriceInfo)
PriceInfo <-function(x){
every <-as.data.frame(x["buy_links"])
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
>>>>>>> fcde3bd6336802dcb285a11b0a09f56d3bb1b213
}
return(price2)
}
results <-lapply(split(combined.df,1:nrow(combined.df)),PriceInfo(x))
arow <-combined.df[205,]
every <-as.data.frame(arow["buy_links"])
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
arow <-combined.df[205,]
every <-as.data.frame(arow["buy_links"])
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
<<<<<<< HEAD
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
})
time.period <-seq(as.Date("2016-03-12"), as.Date("2016-03-12"), by=1)
=======
price <-page %>% html_nodes('#pdp-cur-price') %>% html_text()
price <-as.numeric(sub('\\$','',as.character(price)))
return(price) }
test <-do.call(rbind,lapply(1:nrow(combined.df),PriceInfo))
PriceInfo <- function (newrow) {
every <-arow["buy_links"]
all.price.url <-as.data.frame(every[1,1])
bn.price.url <-all.price.url[3,2]
page <-read_html(GET(price.url,user_agent("myagent")))
price <-page %>% html_nodes('#pdp-cur-price') %>% html_text()
price <-as.numeric(sub('\\$','',as.character(price)))
return(price)
}
test <-do.call(rbind,lapply(1:nrow(combined.df),PriceInfo))
PriceInfo <- function (newrow) {
every <-newrow["buy_links"]
all.price.url <-as.data.frame(every[1,1])
bn.price.url <-all.price.url[3,2]
page <-read_html(GET(price.url,user_agent("myagent")))
price <-page %>% html_nodes('#pdp-cur-price') %>% html_text()
price <-as.numeric(sub('\\$','',as.character(price)))
return(price)
}
test <-do.call(rbind,lapply(1:nrow(combined.df),PriceInfo))
every <-arow["buy_links"]
class(every)
all.price.url <-as.data.frame(every$buy_links)
all.price.url
View(all.price.url)
bn.price.url <-all.price.url[name="Barnes and Noble",2]
bn.price.url <-all.price.url[name=="Barnes and Noble",2]
bn.price.url <-all.price.url[all.price.url$name=="Barnes and Noble",2]
page <-read_html(GET(price.url,user_agent("myagent")))
price <-page %>% html_nodes('#pdp-cur-price') %>% html_text()
price <-as.numeric(sub('\\$','',as.character(price)))
PriceInfo <- function (newrow) {
every <-newrow["buy_links"]
all.price.url <-as.data.frame(every$buy_links)
bn.price.url <-all.price.url[all.price.url$name=="Barnes and Noble",2]
page <-read_html(GET(price.url,user_agent("myagent")))
price <-page %>% html_nodes('#pdp-cur-price') %>% html_text()
price <-as.numeric(sub('\\$','',as.character(price)))
return(price)
}
test <-do.call(rbind,lapply(1:nrow(combined.df),PriceInfo))
all.price.url <-as.data.frame(every["buy_links"])
View(all.price.url)
every <-newrow["buy_links"]
every <-arow["buy_links"]
View(every)
all.price.url <-every["buy_links"]
View(all.price)
View(all.price.url)
all.price.url <-every$buy_links
PriceInfo <- function (newrow) {
every <-newrow["buy_links"]
all.price.url <-as.data.frame(every$buy_links)
bn.price.url <-all.price.url[all.price.url$name=="Barnes and Noble",2]
page <-read_html(GET(price.url,user_agent("myagent")))
price <-page %>% html_nodes('#pdp-cur-price') %>% html_text()
price <-as.numeric(sub('\\$','',as.character(price)))
return(price)
}
test <-do.call(rbind,lapply(1:nrow(combined.df),PriceInfo))
is.recursive(every$buy_links)
is.atomic(every$buy_links)
PriceInfo <- function (newrow) {
every <-newrow["buy_links"]
all.price.url <-as.data.frame(every$buy_links)
bn.price.url <-all.price.url[all.price.url$name=="Barnes and Noble",2]
page <-read_html(GET(price.url,user_agent("myagent")))
price <-page %>% html_nodes('#pdp-cur-price') %>% html_text()
price <-as.numeric(sub('\\$','',as.character(price)))
return(price)
}
test <-do.call(rbind,lapply(1:nrow(combined.df),PriceInfo))
every$buy_links
>>>>>>> 012268d2e44cff24062c79f818516d218ed9a529
library(httr)
library(jsonlite)
library(tidytext)
library(dplyr)
library(stringr)
library(ggplot2)
library(rvest)
library(curl)
<<<<<<< HEAD
#source("api.key.R")
date <- '2016-02-02'
key <- "2f6f47e7312b49239cd7617099bee3fe"
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <-list("api-key"=key, "published_date"=date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
list <- results$results.lists.books
list <- as.data.frame(results$results.lists.books)
View(list)
list.1 <- list %>% select(author,title,weeks_on_list)
list.2 <- list %>% select(author.8)
list.2
row.names(list)
colnames(list)
t(list)
View(list)
list <- as.data.frame(results$results.lists.books)
t(list)
View(list.1)
length(results$results.lists.books)
datalist <- list()
for (i in 1:5) {
dat <- data.frame(x = rnorm(10), y = runif(10))
dat$i <- i
datalist[[i]] <- dat
}
list <- as.data.frame(results$results.lists.books)
info_total <- list %>% select(author,title,weeks_on_list)
datalist <- list()
for (i in 2:5) {
info <- list %>% select(author, title, weeks_on_list)
df <- data.frame(info)
df_total <- rbind(info_total, df)
}
View(info_total)
View(df_total)
View(list)
colnames(list)[which(names(list) == "author1")] <- "author"
View(list)
colnames(list)[which(names(list) == "author.1")] <- "author"
info <- list %>% select(author, title, weeks_on_list)
list <- as.data.frame(results$results.lists.books)
colnames(list)[which(names(list) == "author.1")] <- "author"
colnames(list)[which(names(list) == "title.1")] <- "title"
colnames(list)[which(names(list) == "weeks_on_list.1")] <- "weeks_on_list"
info <- list %>% select(author, title, weeks_on_list)
datalist <- list()
for (i in 2:5) {
info <- list %>% select(author, title, weeks_on_list)
df <- data.frame(info)
info_total <- rbind(info_total, df)
}
info <- list %>% select(author, title, weeks_on_list)
info <- list %>% select(author.2, title.2, weeks_on_list.2)
list <- as.data.frame(results$results.lists.books)
colnames(list)[which(names(list) == "author.1")] <- "author"
colnames(list)[which(names(list) == "title.1")] <- "title"
colnames(list)[which(names(list) == "weeks_on_list.1")] <- "weeks_on_list"
info <- list %>% select(author.2, title.2, weeks_on_list.2)
date <- '2016-02-02'
key <- "2f6f47e7312b49239cd7617099bee3fe"
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <-list("api-key"=key, "published_date"=date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
list <- as.data.frame(results$results.lists.books)
colnames(list)[which(names(list) == "author.1")] <- "author"
colnames(list)[which(names(list) == "title.1")] <- "title"
colnames(list)[which(names(list) == "weeks_on_list.1")] <- "weeks_on_list"
info <- list %>% select(author.2, title.2, weeks_on_list.2)
list <- as.data.frame(results$results.lists.books)
View(list.2)
View(list.1)
View(list.2)
info2 <- list %>% select(author.2, title.2, weeks_on_list.2)
View(info2)
info2 <- list %>% select(author, title, weeks_on_list)
View(info2)
View(list)
list <- as.data.frame(results$results.lists.books)
colnames(list)[which(names(list) == "author.1")] <- "author"
colnames(list)[which(names(list) == "title.1")] <- "title"
colnames(list)[which(names(list) == "weeks_on_list.1")] <- "weeks_on_list"
info2 <- list %>% select(author, title, weeks_on_list)
list <- as.data.frame(results$results.lists.books)
colnames(list)[which(names(list) == "author.1")] <- "author"
colnames(list)[which(names(list) == "title.1")] <- "title"
colnames(list)[which(names(list) == "weeks_on_list.1")] <- "weeks_on_list"
info3 <- list %>% select(author, title, weeks_on_list)
=======
source("api.key.R")
time.period <-seq(as.Date("2016-03-12"), as.Date("2016-03-20"), by=1)
>>>>>>> bd5975d09bd904042fef0491467cbb612a5ab9a0
OneDateInfo <- function (date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <-list("api-key"=yiran.api.key, "published_date"=date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
UsefulInfo <- by(results,1:nrow(results),function(row){
each <-as.data.frame(row$results.lists.books)
return(each)
})
all.useful <-do.call(rbind,UsefulInfo)
}
combined.df <-lapply(time.period,OneDateInfo)
combined.df <-as.data.frame(do.call(rbind,combined.df))
combined.df <-unique(combined.df) %>%
select(title, weeks_on_list, buy_links)
row.names(combined.df) <-NULL
library(httr)
library(jsonlite)
library(tidytext)
library(dplyr)
library(stringr)
library(ggplot2)
library(rvest)
library(curl)
source("api.key.R")
time.period <-seq(as.Date("2016-03-12"), as.Date("2016-03-12"), by=1)
OneDateInfo <- function (date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <-list("api-key"=yiran.api.key, "published_date"=date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
UsefulInfo <- by(results,1:nrow(results),function(row){
each <-as.data.frame(row$results.lists.books)
return(each)
})
all.useful <-do.call(rbind,UsefulInfo)
}
combined.df <-lapply(time.period,OneDateInfo)
combined.df <-as.data.frame(do.call(rbind,combined.df))
combined.df <-unique(combined.df) %>%
select(title, weeks_on_list, buy_links)
<<<<<<< HEAD
row.names(combined.df) <-NULL
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
})
View(combined.df)
arow <-combined.df[1,]
every <-as.data.frame(arow["buy_links"])
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
library(httr)
library(jsonlite)
library(tidytext)
library(dplyr)
library(stringr)
library(ggplot2)
library(rvest)
library(curl)
source("api.key.R")
arow <-combined.df[1,]
every <-as.data.frame(arow["buy_links"])
price.url<-every[3,2]
page <- read_html(price.url)
price.url
every <-as.data.frame(arow["buy_links"])
arow <-combined.df[1,]
every
View(every)
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
=======
combined.df
>>>>>>> 012268d2e44cff24062c79f818516d218ed9a529
>>>>>>> bd5975d09bd904042fef0491467cbb612a5ab9a0
View(dat)
View(df)
library(httr)
library(jsonlite)
library(tidytext)
library(dplyr)
library(stringr)
library(ggplot2)
library(rvest)
library(curl)
library(httr)
library(jsonlite)
library(dplyr)
library(stringr)
library(ggplot2)
library(curl)
weihao.qpi.key = 'd5996a954fbf40e788bf0a3a16e5643c'
getPublisherInfo <- function(date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <- list("api-key" = weihao.api.key, "published_date" = date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
}
getPublisherInfo('2017-12-10')
weihao.api.key = 'd5996a954fbf40e788bf0a3a16e5643c'
getPublisherInfo('2017-12-10')
check <- getPublisherInfo('2017-12-10')
View(check)
getPublisherInfo <- function(date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <- list("api-key" = weihao.api.key, "published_date" = date)
response <- GET(base.url, query = query.params)
body <- content (response, "text")
results <- fromJSON(body)
}
check <- getPublisherInfo('2017-12-10')
getPublisher <- results$publisher
check <- getPublisherInfo('2017-12-10')
getPublisherInfo <- function(date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <- list("api-key" = weihao.api.key, "published_date" = date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
return(results)
}
getPublisherInfo <- function(date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <- list("api-key" = weihao.api.key, "published_date" = date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
return(results)
}
getPublisher <- function(date){
results <- getPublisherInfo(date)
create.data.frame(results)
}
check <- getPublisherInfo('2017-12-10')
View(check)
library(jsonlite)
library(dplyr)
library(ggplot2)
date <- '2017-01-02'
getPublisher <- function(date){
results <- getPublisherInfo(date)
create.data.frame(results)
}
View(info_total)
View(info)
View(info_total)
View(list)
create.publisher.list <- function(results) {
list <- as.data.frame(results$results.lists.books)
length <- as.numeric(length(results$results.lists.books))
info_total <- list %>% select(publisher, title, weeks_on_list)
for (i in 1:(length - 1)) {
i <- as.numeric(i)
publisher.row <- paste0('publisher.', i)
title.row <- paste0('title.', i)
weeks_on_list.row <- paste0('weeks_on_list.', i)
info <- list %>% select(publisher = publisher.row,
title = title.row,
weeks_on_list = weeks_on_list.row)
df <- data.frame(info)
info_total <- rbind(info_total, df)
}
info_total <- info_total %>%
distinct() %>%
group_by(publisher) %>%
arrange(-weeks_on_list)
return(info_total)
}
getPublisher <- function(date){
results <- getPublisherInfo(date)
create.publisher.list(results)
}
View(info)
View(info_total)
View(info2)
View(list.1)
View(info_total)
View(results)
View(results)
info_total <- list %>% select(publisher, title, weeks_on_list)
info_total <- list %>% select(publisher, title, weeks_on_list)
publisher.row <- paste0('publisher.', i)
info <- list %>% select(publisher = publisher.row,
title = title.row,
weeks_on_list = weeks_on_list.row)
for (i in 1:(length - 1)) {
i <- as.numeric(i)
publisher.row <- paste0('publisher.', i)
title.row <- paste0('title.', i)
weeks_on_list.row <- paste0('weeks_on_list.', i)
info <- list %>% select(publisher = publisher.row,
title = title.row,
weeks_on_list = weeks_on_list.row)
df <- data.frame(info)
info_total <- rbind(allInfo, df)
}
return(allInfo)
allInfo <- list %>% select(publisher, title, weeks_on_list)
getPublisher <- function(date){
results <- getPublisherInfo(date)
create.publisher.list(results)
}
library(jsonlite)
library(dplyr)
library(ggplot2)
weihao.api.key = 'd5996a954fbf40e788bf0a3a16e5643c'
date <- '2017-01-02'
getPublisherInfo <- function(date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <- list("api-key" = weihao.api.key, "published_date" = date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
list <- as.data.frame(results$results.lists.books)
length <- as.numeric(length(results$results.lists.books))
allInfo <- list %>% select(publisher, title, weeks_on_list)
for (i in 1:(length - 1)) {
i <- as.numeric(i)
publisher.row <- paste0('publisher.', i)
title.row <- paste0('title.', i)
weeks_on_list.row <- paste0('weeks_on_list.', i)
info <- list %>% select(publisher = publisher.row,
title = title.row,
weeks_on_list = weeks_on_list.row)
df <- data.frame(info)
info_total <- rbind(allInfo, df)
}
info_total <- info_total %>%
distinct() %>%
group_by(publisher) %>%
arrange(-weeks_on_list)
#return(results)
}
View(info_total)
date <- '2017-01-02'
getPublisherInfo <- function(date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <- list("api-key" = weihao.api.key, "published_date" = date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
list <- as.data.frame(results$results.lists.books)
length <- as.numeric(length(results$results.lists.books))
allInfo <- list %>% select(publisher, title, weeks_on_list)
for (i in 1:(length - 1)) {
i <- as.numeric(i)
publisher.row <- paste0('publisher.', i)
title.row <- paste0('title.', i)
weeks_on_list.row <- paste0('weeks_on_list.', i)
info <- list %>% select(publisher = publisher.row,
title = title.row,
weeks_on_list = weeks_on_list.row)
df <- data.frame(info)
info_total <- rbind(allInfo, df)
}
View(info_total)
View(results)
View(list)
