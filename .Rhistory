} else if (length(price1)==0){
price1=NA
print(price1)
}
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
print(price2)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
} else if (length(price1)==0){
price1="NA"
print(price1)
}
price1=NA
x <-5
if (x>4){
print(NA)
}
arow <-combined.df[39,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
print(price2)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
} else if (length(price1)==0){
print(NA)
}
f <- numeric(0)
if (length(f)==0) {
print(NA)
}
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
print(price2)
}
if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
print(price2)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
} else if (length(price2)==0) {
print(NA)
}
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
print(price2)
}
if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price2)==0) {
print(NA)
}
arow <-combined.df[39,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
print(price2)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price2)==0) {
price2=NA
print(price2)
}
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
print(price2)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price2)==0) {
price2=NA
print(price1)
}
})
arow <-combined.df[7,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
arow <-combined.df[7,]
every <-as.data.frame(arow$buy_links)
arow <-combined.df[6,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
arow <-combined.df[7,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
print(price2)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price2)==0) {
price2=NA
print(price2)
}
arow <-combined.df[8,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
print(price2)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price2)==0) {
price2=NA
print(price2)
}
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price1 <-as.numeric(sub('\\$','',as.character(price1)))
print(price1)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price2)==0) {
price3=NA
print(price3)
}
})
x=5
if(y<9) {
print(NA)
}
arow <-combined.df[39,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price1 <-as.numeric(sub('\\$','',as.character(price1)))
print(price1)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price2)==0) {
price3=NA
print(price3)
}
#price data frame by the way of "by rbind"
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price1 <-as.numeric(sub('\\$','',as.character(price1)))
print(price1)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
} else if (length(price2)==0) {
price3=NA
print(price3)
}
})
if (length(price1)==1) {
price1 <-as.numeric(sub('\\$','',as.character(price1)))
print(price1)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
} else if (length(price2)==0) {
price3=NA
print(price3)
}
if (length(price1)==1) {
price1 <-as.numeric(sub('\\$','',as.character(price1)))
print(price1)
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
print(price2)
}
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
})
arow <-combined.df[2,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
if (length(price2)==0) {
price2=NA
}
print(price2)
x=5
arow <-combined.df[2,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
})
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
return(price2)
})
all.price <-do.call(rbind,PriceInfo) #it shows all price for only 312, but there's 315.
PriceInfo
arow <-combined.df[39,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
arow <-combined.df[40,]
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
arow <-combined.df[40,]
every <-as.data.frame(arow["buy_links"])
for(i in 1:nrow(combined.df)) {
every <-as.data.frame(i["buy_links"])
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
return(price2)
}
lapply(combined.df,1:nrow(combined.df),PriceInfo)
PriceInfo <-function(x){
every <-as.data.frame(x["buy_links"])
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
return(price2)
}
results <-lapply(split(combined.df,1:nrow(combined.df)),PriceInfo(x))
arow <-combined.df[205,]
every <-as.data.frame(arow["buy_links"])
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
arow <-combined.df[205,]
every <-as.data.frame(arow["buy_links"])
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
})
time.period <-seq(as.Date("2016-03-12"), as.Date("2016-03-12"), by=1)
OneDateInfo <- function (date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <-list("api-key"=yiran.api.key, "published_date"=date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
UsefulInfo <- by(results,1:nrow(results),function(row){
each <-as.data.frame(row$results.lists.books)
return(each)
})
all.useful <-do.call(rbind,UsefulInfo)
}
combined.df <-lapply(time.period,OneDateInfo)
combined.df <-as.data.frame(do.call(rbind,combined.df))
combined.df <-unique(combined.df) %>%
select(title, weeks_on_list, buy_links)
row.names(combined.df) <-NULL
library(httr)
library(jsonlite)
library(tidytext)
library(dplyr)
library(stringr)
library(ggplot2)
library(rvest)
library(curl)
source("api.key.R")
time.period <-seq(as.Date("2016-03-12"), as.Date("2016-03-12"), by=1)
OneDateInfo <- function (date) {
base.url <-"https://api.nytimes.com/svc/books/v3/lists/overview.json"
query.params <-list("api-key"=yiran.api.key, "published_date"=date)
response <- GET(base.url, query = query.params)
body <-content (response, "text")
results <-as.data.frame(fromJSON(body))
UsefulInfo <- by(results,1:nrow(results),function(row){
each <-as.data.frame(row$results.lists.books)
return(each)
})
all.useful <-do.call(rbind,UsefulInfo)
}
combined.df <-lapply(time.period,OneDateInfo)
combined.df <-as.data.frame(do.call(rbind,combined.df))
combined.df <-unique(combined.df) %>%
select(title, weeks_on_list, buy_links)
row.names(combined.df) <-NULL
PriceInfo <-by(combined.df,1:nrow(combined.df),function(newrow){
every <-as.data.frame(newrow$buy_links)
price.url <-every[3,2]
page <-read_html(GET(price.url,user_agent("myagnet")))
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
if (length(price1)==1) {
price2 <-as.numeric(sub('\\$','',as.character(price1)))
} else if (length(price1)==0) {
price2 <- page %>% html_nodes('#pdp-cur-price-BuyNew') %>% html_text()
price2 <-as.numeric(sub('\\$','',as.character(price2)))
}
if (length(price2)==0) {
price2=NA
}
print(price2)
})
View(combined.df)
arow <-combined.df[1,]
every <-as.data.frame(arow["buy_links"])
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
library(httr)
library(jsonlite)
library(tidytext)
library(dplyr)
library(stringr)
library(ggplot2)
library(rvest)
library(curl)
source("api.key.R")
arow <-combined.df[1,]
every <-as.data.frame(arow["buy_links"])
price.url<-every[3,2]
page <- read_html(price.url)
price.url
every <-as.data.frame(arow["buy_links"])
arow <-combined.df[1,]
every
View(every)
every <-as.data.frame(arow$buy_links)
price.url<-every[3,2]
page <- read_html(price.url)
price1 <- page %>% html_nodes('#pdp-cur-price') %>% html_text()
